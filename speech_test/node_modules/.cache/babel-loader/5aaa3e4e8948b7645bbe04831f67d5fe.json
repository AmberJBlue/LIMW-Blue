{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/blue/Documents/Projects/LIMW-Blue/bridge-viz-test/node_modules/@babel/runtime/regenerator/index.js\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _isAndroid = _interopRequireDefault(require(\"./isAndroid\"));\n\nvar _utils = require(\"./utils\");\n\nvar _NativeSpeechRecognition = require(\"./NativeSpeechRecognition\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar RecognitionManager = /*#__PURE__*/function () {\n  function RecognitionManager(SpeechRecognition) {\n    _classCallCheck(this, RecognitionManager);\n\n    this.recognition = null;\n    this.pauseAfterDisconnect = false;\n    this.interimTranscript = '';\n    this.finalTranscript = '';\n    this.listening = false;\n    this.isMicrophoneAvailable = true;\n    this.subscribers = {};\n\n    this.onStopListening = function () {};\n\n    this.previousResultWasFinalOnly = false;\n    this.resetTranscript = this.resetTranscript.bind(this);\n    this.startListening = this.startListening.bind(this);\n    this.stopListening = this.stopListening.bind(this);\n    this.abortListening = this.abortListening.bind(this);\n    this.setSpeechRecognition = this.setSpeechRecognition.bind(this);\n    this.disableRecognition = this.disableRecognition.bind(this);\n    this.setSpeechRecognition(SpeechRecognition);\n\n    if ((0, _isAndroid[\"default\"])()) {\n      this.updateFinalTranscript = (0, _utils.debounce)(this.updateFinalTranscript, 250, true);\n    }\n  }\n\n  _createClass(RecognitionManager, [{\n    key: \"setSpeechRecognition\",\n    value: function setSpeechRecognition(SpeechRecognition) {\n      var browserSupportsRecogniser = !!SpeechRecognition && ((0, _NativeSpeechRecognition.isNative)(SpeechRecognition) || (0, _utils.browserSupportsPolyfills)());\n\n      if (browserSupportsRecogniser) {\n        this.disableRecognition();\n        this.recognition = new SpeechRecognition();\n        this.recognition.continuous = false;\n        this.recognition.interimResults = true;\n        this.recognition.onresult = this.updateTranscript.bind(this);\n        this.recognition.onend = this.onRecognitionDisconnect.bind(this);\n        this.recognition.onerror = this.onError.bind(this);\n      }\n\n      this.emitBrowserSupportsSpeechRecognitionChange(browserSupportsRecogniser);\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(id, callbacks) {\n      this.subscribers[id] = callbacks;\n    }\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe(id) {\n      delete this.subscribers[id];\n    }\n  }, {\n    key: \"emitListeningChange\",\n    value: function emitListeningChange(listening) {\n      var _this = this;\n\n      this.listening = listening;\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onListeningChange = _this.subscribers[id].onListeningChange;\n        onListeningChange(listening);\n      });\n    }\n  }, {\n    key: \"emitMicrophoneAvailabilityChange\",\n    value: function emitMicrophoneAvailabilityChange(isMicrophoneAvailable) {\n      var _this2 = this;\n\n      this.isMicrophoneAvailable = isMicrophoneAvailable;\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onMicrophoneAvailabilityChange = _this2.subscribers[id].onMicrophoneAvailabilityChange;\n        onMicrophoneAvailabilityChange(isMicrophoneAvailable);\n      });\n    }\n  }, {\n    key: \"emitTranscriptChange\",\n    value: function emitTranscriptChange(interimTranscript, finalTranscript) {\n      var _this3 = this;\n\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onTranscriptChange = _this3.subscribers[id].onTranscriptChange;\n        onTranscriptChange(interimTranscript, finalTranscript);\n      });\n    }\n  }, {\n    key: \"emitClearTranscript\",\n    value: function emitClearTranscript() {\n      var _this4 = this;\n\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onClearTranscript = _this4.subscribers[id].onClearTranscript;\n        onClearTranscript();\n      });\n    }\n  }, {\n    key: \"emitBrowserSupportsSpeechRecognitionChange\",\n    value: function emitBrowserSupportsSpeechRecognitionChange(browserSupportsSpeechRecognitionChange) {\n      var _this5 = this;\n\n      Object.keys(this.subscribers).forEach(function (id) {\n        var _this5$subscribers$id = _this5.subscribers[id],\n            onBrowserSupportsSpeechRecognitionChange = _this5$subscribers$id.onBrowserSupportsSpeechRecognitionChange,\n            onBrowserSupportsContinuousListeningChange = _this5$subscribers$id.onBrowserSupportsContinuousListeningChange;\n        onBrowserSupportsSpeechRecognitionChange(browserSupportsSpeechRecognitionChange);\n        onBrowserSupportsContinuousListeningChange(browserSupportsSpeechRecognitionChange);\n      });\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect(disconnectType) {\n      if (this.recognition && this.listening) {\n        switch (disconnectType) {\n          case 'ABORT':\n            this.pauseAfterDisconnect = true;\n            this.abort();\n            break;\n\n          case 'RESET':\n            this.pauseAfterDisconnect = false;\n            this.abort();\n            break;\n\n          case 'STOP':\n          default:\n            this.pauseAfterDisconnect = true;\n            this.stop();\n        }\n      }\n    }\n  }, {\n    key: \"disableRecognition\",\n    value: function disableRecognition() {\n      if (this.recognition) {\n        this.recognition.onresult = function () {};\n\n        this.recognition.onend = function () {};\n\n        this.recognition.onerror = function () {};\n\n        if (this.listening) {\n          this.stopListening();\n        }\n      }\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(event) {\n      if (event && event.error && event.error === 'not-allowed') {\n        this.emitMicrophoneAvailabilityChange(false);\n        this.disableRecognition();\n      }\n    }\n  }, {\n    key: \"onRecognitionDisconnect\",\n    value: function onRecognitionDisconnect() {\n      this.onStopListening();\n      this.listening = false;\n\n      if (this.pauseAfterDisconnect) {\n        this.emitListeningChange(false);\n      } else if (this.recognition) {\n        if (this.recognition.continuous) {\n          this.startListening({\n            continuous: this.recognition.continuous\n          });\n        } else {\n          this.emitListeningChange(false);\n        }\n      }\n\n      this.pauseAfterDisconnect = false;\n    }\n  }, {\n    key: \"updateTranscript\",\n    value: function updateTranscript(_ref) {\n      var results = _ref.results,\n          resultIndex = _ref.resultIndex;\n      var currentIndex = resultIndex === undefined ? results.length - 1 : resultIndex;\n      this.interimTranscript = '';\n      this.finalTranscript = '';\n\n      for (var i = currentIndex; i < results.length; ++i) {\n        if (results[i].isFinal && (!(0, _isAndroid[\"default\"])() || results[i][0].confidence > 0)) {\n          this.updateFinalTranscript(results[i][0].transcript);\n        } else {\n          this.interimTranscript = (0, _utils.concatTranscripts)(this.interimTranscript, results[i][0].transcript);\n        }\n      }\n\n      var isDuplicateResult = false;\n\n      if (this.interimTranscript === '' && this.finalTranscript !== '') {\n        if (this.previousResultWasFinalOnly) {\n          isDuplicateResult = true;\n        }\n\n        this.previousResultWasFinalOnly = true;\n      } else {\n        this.previousResultWasFinalOnly = false;\n      }\n\n      if (!isDuplicateResult) {\n        this.emitTranscriptChange(this.interimTranscript, this.finalTranscript);\n      }\n    }\n  }, {\n    key: \"updateFinalTranscript\",\n    value: function updateFinalTranscript(newFinalTranscript) {\n      this.finalTranscript = (0, _utils.concatTranscripts)(this.finalTranscript, newFinalTranscript);\n    }\n  }, {\n    key: \"resetTranscript\",\n    value: function resetTranscript() {\n      this.disconnect('RESET');\n    }\n  }, {\n    key: \"startListening\",\n    value: function () {\n      var _startListening = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _ref2,\n            _ref2$continuous,\n            continuous,\n            language,\n            isContinuousChanged,\n            isLanguageChanged,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _ref2 = _args.length > 0 && _args[0] !== undefined ? _args[0] : {}, _ref2$continuous = _ref2.continuous, continuous = _ref2$continuous === void 0 ? false : _ref2$continuous, language = _ref2.language;\n\n                if (this.recognition) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                isContinuousChanged = continuous !== this.recognition.continuous;\n                isLanguageChanged = language && language !== this.recognition.lang;\n\n                if (!(isContinuousChanged || isLanguageChanged)) {\n                  _context.next = 11;\n                  break;\n                }\n\n                if (!this.listening) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.next = 9;\n                return this.stopListening();\n\n              case 9:\n                this.recognition.continuous = isContinuousChanged ? continuous : this.recognition.continuous;\n                this.recognition.lang = isLanguageChanged ? language : this.recognition.lang;\n\n              case 11:\n                if (this.listening) {\n                  _context.next = 22;\n                  break;\n                }\n\n                if (!this.recognition.continuous) {\n                  this.resetTranscript();\n                  this.emitClearTranscript();\n                }\n\n                _context.prev = 13;\n                _context.next = 16;\n                return this.start();\n\n              case 16:\n                this.emitListeningChange(true);\n                _context.next = 22;\n                break;\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](13); // DOMExceptions indicate a redundant microphone start - safe to swallow\n\n                if (!(_context.t0 instanceof DOMException)) {\n                  this.emitMicrophoneAvailabilityChange(false);\n                }\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[13, 19]]);\n      }));\n\n      function startListening() {\n        return _startListening.apply(this, arguments);\n      }\n\n      return startListening;\n    }()\n  }, {\n    key: \"abortListening\",\n    value: function () {\n      var _abortListening = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this6 = this;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.disconnect('ABORT');\n                this.emitListeningChange(false);\n                _context2.next = 4;\n                return new Promise(function (resolve) {\n                  _this6.onStopListening = resolve;\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function abortListening() {\n        return _abortListening.apply(this, arguments);\n      }\n\n      return abortListening;\n    }()\n  }, {\n    key: \"stopListening\",\n    value: function () {\n      var _stopListening = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var _this7 = this;\n\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.disconnect('STOP');\n                this.emitListeningChange(false);\n                _context3.next = 4;\n                return new Promise(function (resolve) {\n                  _this7.onStopListening = resolve;\n                });\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function stopListening() {\n        return _stopListening.apply(this, arguments);\n      }\n\n      return stopListening;\n    }()\n  }, {\n    key: \"getRecognition\",\n    value: function getRecognition() {\n      return this.recognition;\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n        return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(this.recognition && !this.listening)) {\n                  _context4.next = 4;\n                  break;\n                }\n\n                _context4.next = 3;\n                return this.recognition.start();\n\n              case 3:\n                this.listening = true;\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function start() {\n        return _start.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      if (this.recognition && this.listening) {\n        this.recognition.stop();\n        this.listening = false;\n      }\n    }\n  }, {\n    key: \"abort\",\n    value: function abort() {\n      if (this.recognition && this.listening) {\n        this.recognition.abort();\n        this.listening = false;\n      }\n    }\n  }]);\n\n  return RecognitionManager;\n}();\n\nexports[\"default\"] = RecognitionManager;","map":{"version":3,"sources":["/Users/blue/Documents/Projects/LIMW-Blue/bridge-viz-test/node_modules/react-speech-recognition/lib/RecognitionManager.js"],"names":["Object","defineProperty","exports","value","_isAndroid","_interopRequireDefault","require","_utils","_NativeSpeechRecognition","obj","__esModule","asyncGeneratorStep","gen","resolve","reject","_next","_throw","key","arg","info","error","done","Promise","then","_asyncToGenerator","fn","self","args","arguments","apply","err","undefined","_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","_createClass","protoProps","staticProps","prototype","RecognitionManager","SpeechRecognition","recognition","pauseAfterDisconnect","interimTranscript","finalTranscript","listening","isMicrophoneAvailable","subscribers","onStopListening","previousResultWasFinalOnly","resetTranscript","bind","startListening","stopListening","abortListening","setSpeechRecognition","disableRecognition","updateFinalTranscript","debounce","browserSupportsRecogniser","isNative","browserSupportsPolyfills","continuous","interimResults","onresult","updateTranscript","onend","onRecognitionDisconnect","onerror","onError","emitBrowserSupportsSpeechRecognitionChange","subscribe","id","callbacks","unsubscribe","emitListeningChange","_this","keys","forEach","onListeningChange","emitMicrophoneAvailabilityChange","_this2","onMicrophoneAvailabilityChange","emitTranscriptChange","_this3","onTranscriptChange","emitClearTranscript","_this4","onClearTranscript","browserSupportsSpeechRecognitionChange","_this5","_this5$subscribers$id","onBrowserSupportsSpeechRecognitionChange","onBrowserSupportsContinuousListeningChange","disconnect","disconnectType","abort","stop","event","_ref","results","resultIndex","currentIndex","isFinal","confidence","transcript","concatTranscripts","isDuplicateResult","newFinalTranscript","_startListening","mark","_callee","_ref2","_ref2$continuous","language","isContinuousChanged","isLanguageChanged","_args","wrap","_callee$","_context","prev","next","abrupt","lang","start","t0","DOMException","_abortListening","_callee2","_this6","_callee2$","_context2","_stopListening","_callee3","_this7","_callee3$","_context3","getRecognition","_start","_callee4","_callee4$","_context4"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n\nvar _isAndroid = _interopRequireDefault(require(\"./isAndroid\"));\n\nvar _utils = require(\"./utils\");\n\nvar _NativeSpeechRecognition = require(\"./NativeSpeechRecognition\");\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\n\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar RecognitionManager = /*#__PURE__*/function () {\n  function RecognitionManager(SpeechRecognition) {\n    _classCallCheck(this, RecognitionManager);\n\n    this.recognition = null;\n    this.pauseAfterDisconnect = false;\n    this.interimTranscript = '';\n    this.finalTranscript = '';\n    this.listening = false;\n    this.isMicrophoneAvailable = true;\n    this.subscribers = {};\n\n    this.onStopListening = function () {};\n\n    this.previousResultWasFinalOnly = false;\n    this.resetTranscript = this.resetTranscript.bind(this);\n    this.startListening = this.startListening.bind(this);\n    this.stopListening = this.stopListening.bind(this);\n    this.abortListening = this.abortListening.bind(this);\n    this.setSpeechRecognition = this.setSpeechRecognition.bind(this);\n    this.disableRecognition = this.disableRecognition.bind(this);\n    this.setSpeechRecognition(SpeechRecognition);\n\n    if ((0, _isAndroid[\"default\"])()) {\n      this.updateFinalTranscript = (0, _utils.debounce)(this.updateFinalTranscript, 250, true);\n    }\n  }\n\n  _createClass(RecognitionManager, [{\n    key: \"setSpeechRecognition\",\n    value: function setSpeechRecognition(SpeechRecognition) {\n      var browserSupportsRecogniser = !!SpeechRecognition && ((0, _NativeSpeechRecognition.isNative)(SpeechRecognition) || (0, _utils.browserSupportsPolyfills)());\n\n      if (browserSupportsRecogniser) {\n        this.disableRecognition();\n        this.recognition = new SpeechRecognition();\n        this.recognition.continuous = false;\n        this.recognition.interimResults = true;\n        this.recognition.onresult = this.updateTranscript.bind(this);\n        this.recognition.onend = this.onRecognitionDisconnect.bind(this);\n        this.recognition.onerror = this.onError.bind(this);\n      }\n\n      this.emitBrowserSupportsSpeechRecognitionChange(browserSupportsRecogniser);\n    }\n  }, {\n    key: \"subscribe\",\n    value: function subscribe(id, callbacks) {\n      this.subscribers[id] = callbacks;\n    }\n  }, {\n    key: \"unsubscribe\",\n    value: function unsubscribe(id) {\n      delete this.subscribers[id];\n    }\n  }, {\n    key: \"emitListeningChange\",\n    value: function emitListeningChange(listening) {\n      var _this = this;\n\n      this.listening = listening;\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onListeningChange = _this.subscribers[id].onListeningChange;\n        onListeningChange(listening);\n      });\n    }\n  }, {\n    key: \"emitMicrophoneAvailabilityChange\",\n    value: function emitMicrophoneAvailabilityChange(isMicrophoneAvailable) {\n      var _this2 = this;\n\n      this.isMicrophoneAvailable = isMicrophoneAvailable;\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onMicrophoneAvailabilityChange = _this2.subscribers[id].onMicrophoneAvailabilityChange;\n        onMicrophoneAvailabilityChange(isMicrophoneAvailable);\n      });\n    }\n  }, {\n    key: \"emitTranscriptChange\",\n    value: function emitTranscriptChange(interimTranscript, finalTranscript) {\n      var _this3 = this;\n\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onTranscriptChange = _this3.subscribers[id].onTranscriptChange;\n        onTranscriptChange(interimTranscript, finalTranscript);\n      });\n    }\n  }, {\n    key: \"emitClearTranscript\",\n    value: function emitClearTranscript() {\n      var _this4 = this;\n\n      Object.keys(this.subscribers).forEach(function (id) {\n        var onClearTranscript = _this4.subscribers[id].onClearTranscript;\n        onClearTranscript();\n      });\n    }\n  }, {\n    key: \"emitBrowserSupportsSpeechRecognitionChange\",\n    value: function emitBrowserSupportsSpeechRecognitionChange(browserSupportsSpeechRecognitionChange) {\n      var _this5 = this;\n\n      Object.keys(this.subscribers).forEach(function (id) {\n        var _this5$subscribers$id = _this5.subscribers[id],\n            onBrowserSupportsSpeechRecognitionChange = _this5$subscribers$id.onBrowserSupportsSpeechRecognitionChange,\n            onBrowserSupportsContinuousListeningChange = _this5$subscribers$id.onBrowserSupportsContinuousListeningChange;\n        onBrowserSupportsSpeechRecognitionChange(browserSupportsSpeechRecognitionChange);\n        onBrowserSupportsContinuousListeningChange(browserSupportsSpeechRecognitionChange);\n      });\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect(disconnectType) {\n      if (this.recognition && this.listening) {\n        switch (disconnectType) {\n          case 'ABORT':\n            this.pauseAfterDisconnect = true;\n            this.abort();\n            break;\n\n          case 'RESET':\n            this.pauseAfterDisconnect = false;\n            this.abort();\n            break;\n\n          case 'STOP':\n          default:\n            this.pauseAfterDisconnect = true;\n            this.stop();\n        }\n      }\n    }\n  }, {\n    key: \"disableRecognition\",\n    value: function disableRecognition() {\n      if (this.recognition) {\n        this.recognition.onresult = function () {};\n\n        this.recognition.onend = function () {};\n\n        this.recognition.onerror = function () {};\n\n        if (this.listening) {\n          this.stopListening();\n        }\n      }\n    }\n  }, {\n    key: \"onError\",\n    value: function onError(event) {\n      if (event && event.error && event.error === 'not-allowed') {\n        this.emitMicrophoneAvailabilityChange(false);\n        this.disableRecognition();\n      }\n    }\n  }, {\n    key: \"onRecognitionDisconnect\",\n    value: function onRecognitionDisconnect() {\n      this.onStopListening();\n      this.listening = false;\n\n      if (this.pauseAfterDisconnect) {\n        this.emitListeningChange(false);\n      } else if (this.recognition) {\n        if (this.recognition.continuous) {\n          this.startListening({\n            continuous: this.recognition.continuous\n          });\n        } else {\n          this.emitListeningChange(false);\n        }\n      }\n\n      this.pauseAfterDisconnect = false;\n    }\n  }, {\n    key: \"updateTranscript\",\n    value: function updateTranscript(_ref) {\n      var results = _ref.results,\n          resultIndex = _ref.resultIndex;\n      var currentIndex = resultIndex === undefined ? results.length - 1 : resultIndex;\n      this.interimTranscript = '';\n      this.finalTranscript = '';\n\n      for (var i = currentIndex; i < results.length; ++i) {\n        if (results[i].isFinal && (!(0, _isAndroid[\"default\"])() || results[i][0].confidence > 0)) {\n          this.updateFinalTranscript(results[i][0].transcript);\n        } else {\n          this.interimTranscript = (0, _utils.concatTranscripts)(this.interimTranscript, results[i][0].transcript);\n        }\n      }\n\n      var isDuplicateResult = false;\n\n      if (this.interimTranscript === '' && this.finalTranscript !== '') {\n        if (this.previousResultWasFinalOnly) {\n          isDuplicateResult = true;\n        }\n\n        this.previousResultWasFinalOnly = true;\n      } else {\n        this.previousResultWasFinalOnly = false;\n      }\n\n      if (!isDuplicateResult) {\n        this.emitTranscriptChange(this.interimTranscript, this.finalTranscript);\n      }\n    }\n  }, {\n    key: \"updateFinalTranscript\",\n    value: function updateFinalTranscript(newFinalTranscript) {\n      this.finalTranscript = (0, _utils.concatTranscripts)(this.finalTranscript, newFinalTranscript);\n    }\n  }, {\n    key: \"resetTranscript\",\n    value: function resetTranscript() {\n      this.disconnect('RESET');\n    }\n  }, {\n    key: \"startListening\",\n    value: function () {\n      var _startListening = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {\n        var _ref2,\n            _ref2$continuous,\n            continuous,\n            language,\n            isContinuousChanged,\n            isLanguageChanged,\n            _args = arguments;\n\n        return regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _ref2 = _args.length > 0 && _args[0] !== undefined ? _args[0] : {}, _ref2$continuous = _ref2.continuous, continuous = _ref2$continuous === void 0 ? false : _ref2$continuous, language = _ref2.language;\n\n                if (this.recognition) {\n                  _context.next = 3;\n                  break;\n                }\n\n                return _context.abrupt(\"return\");\n\n              case 3:\n                isContinuousChanged = continuous !== this.recognition.continuous;\n                isLanguageChanged = language && language !== this.recognition.lang;\n\n                if (!(isContinuousChanged || isLanguageChanged)) {\n                  _context.next = 11;\n                  break;\n                }\n\n                if (!this.listening) {\n                  _context.next = 9;\n                  break;\n                }\n\n                _context.next = 9;\n                return this.stopListening();\n\n              case 9:\n                this.recognition.continuous = isContinuousChanged ? continuous : this.recognition.continuous;\n                this.recognition.lang = isLanguageChanged ? language : this.recognition.lang;\n\n              case 11:\n                if (this.listening) {\n                  _context.next = 22;\n                  break;\n                }\n\n                if (!this.recognition.continuous) {\n                  this.resetTranscript();\n                  this.emitClearTranscript();\n                }\n\n                _context.prev = 13;\n                _context.next = 16;\n                return this.start();\n\n              case 16:\n                this.emitListeningChange(true);\n                _context.next = 22;\n                break;\n\n              case 19:\n                _context.prev = 19;\n                _context.t0 = _context[\"catch\"](13);\n\n                // DOMExceptions indicate a redundant microphone start - safe to swallow\n                if (!(_context.t0 instanceof DOMException)) {\n                  this.emitMicrophoneAvailabilityChange(false);\n                }\n\n              case 22:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[13, 19]]);\n      }));\n\n      function startListening() {\n        return _startListening.apply(this, arguments);\n      }\n\n      return startListening;\n    }()\n  }, {\n    key: \"abortListening\",\n    value: function () {\n      var _abortListening = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2() {\n        var _this6 = this;\n\n        return regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.disconnect('ABORT');\n                this.emitListeningChange(false);\n                _context2.next = 4;\n                return new Promise(function (resolve) {\n                  _this6.onStopListening = resolve;\n                });\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function abortListening() {\n        return _abortListening.apply(this, arguments);\n      }\n\n      return abortListening;\n    }()\n  }, {\n    key: \"stopListening\",\n    value: function () {\n      var _stopListening = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {\n        var _this7 = this;\n\n        return regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                this.disconnect('STOP');\n                this.emitListeningChange(false);\n                _context3.next = 4;\n                return new Promise(function (resolve) {\n                  _this7.onStopListening = resolve;\n                });\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function stopListening() {\n        return _stopListening.apply(this, arguments);\n      }\n\n      return stopListening;\n    }()\n  }, {\n    key: \"getRecognition\",\n    value: function getRecognition() {\n      return this.recognition;\n    }\n  }, {\n    key: \"start\",\n    value: function () {\n      var _start = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {\n        return regeneratorRuntime.wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                if (!(this.recognition && !this.listening)) {\n                  _context4.next = 4;\n                  break;\n                }\n\n                _context4.next = 3;\n                return this.recognition.start();\n\n              case 3:\n                this.listening = true;\n\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n\n      function start() {\n        return _start.apply(this, arguments);\n      }\n\n      return start;\n    }()\n  }, {\n    key: \"stop\",\n    value: function stop() {\n      if (this.recognition && this.listening) {\n        this.recognition.stop();\n        this.listening = false;\n      }\n    }\n  }, {\n    key: \"abort\",\n    value: function abort() {\n      if (this.recognition && this.listening) {\n        this.recognition.abort();\n        this.listening = false;\n      }\n    }\n  }]);\n\n  return RecognitionManager;\n}();\n\nexports[\"default\"] = RecognitionManager;"]},"metadata":{},"sourceType":"script"}